{% extends 'VkafOafBundle:Schedule:layout.html.twig' %}
{% import _self as self %}

{% block title_full %}{{ schedule.name }} - {{ 'zentrium_schedule.layout.schedule'|trans }}{% endblock %}
{% block title %}{{ schedule.name }}{% endblock %}

{% macro renderShift(shift, type) %}
<div class="slot-shift-end" style="background-color: {{ shift.task.color }}; border-color: {{ shift.task.color }}">{{ shift.task.name }} ({{ shift.task.code }})</div>
{% endmacro %}

{% block content %}
<div class="row">
  <div class="col-md-4 col-md-offset-4">
    <div class="box box-solid">
      <div class="box-body slot-header">
        {% if slot > 0 %}
        <a href="{{ path('oaf_schedule_slot', {'schedule': schedule.id, 'slot': (slot - 1)}) }}" class="slot-prev"><i class="fa fa-chevron-left"></i></a>
        {% endif %}
        {% if slot < schedule.slotCount %}
        <a href="{{ path('oaf_schedule_slot', {'schedule': schedule.id, 'slot': (slot + 1)}) }}" class="slot-next"><i class="fa fa-chevron-right"></i></a>
        {% endif %}
        <h4>{{ slotDate|localizedDate('date_full') }}</h4>
        <h3>{{ slotDate|date('H:i') }}</h3>
      </div>
    </div>
  </div>
</div>
<div class="row">
  <div class="col-md-4">
    <div class="box box-solid slot-left">
      <div class="box-header with-border">
        <h3 class="box-title">{{ 'vkaf_oaf.schedule.slot.ending'|trans }}</h3>
      </div>
      <div class="box-body">
        {% for row in groupedShifts %}
          {% if row.ending|length and not row.beginning|length %}
            <p>{{ row.user.name }}</p>
            {% for shift in row.ending %}
            {{ self.renderShift(shift, 'end') }}
            {% endfor %}
          {% endif %}
        {% endfor %}
      </div>
    </div>
  </div>
  <div class="col-md-4">
    <div class="box box-solid slot-center">
      <div class="box-header with-border">
        <h3 class="box-title">{{ 'vkaf_oaf.schedule.slot.changing'|trans }}</h3>
      </div>
      <div class="box-body">
        {% for row in groupedShifts %}
          {% if row.ending|length and row.beginning|length %}
            <p>{{ row.user.name }}</p>
            {% for shift in row.ending %}
            {{ self.renderShift(shift, 'end') }}
            {% endfor %}
            {% for shift in row.beginning %}
            {{ self.renderShift(shift, 'begin') }}
            {% endfor %}
          {% endif %}
        {% endfor %}
      </div>
    </div>
  </div>
  <div class="col-md-4">
    <div class="box box-solid slot-right">
      <div class="box-header with-border">
        <h3 class="box-title">{{ 'vkaf_oaf.schedule.slot.beginning'|trans }}</h3>
      </div>
      <div class="box-body">
        {% for row in groupedShifts %}
          {% if not row.ending|length and row.beginning|length %}
            <p>{{ row.user.name }}</p>
            {% for shift in row.beginning %}
            {{ self.renderShift(shift, 'begin') }}
            {% endfor %}
          {% endif %}
        {% endfor %}
      </div>
    </div>
  </div>
</div>
{% endblock %}
